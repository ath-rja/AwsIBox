{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Conditions": {
        "EFSFileSystemEcsCluster": {
            "Fn::Not": [
                {
                    "Fn::Equals": [
                        {
                            "Fn::FindInMap": [
                                {
                                    "Ref": "EnvShort"
                                },
                                {
                                    "Ref": "AWS::Region"
                                },
                                "EFSFileSystemEcsClusterEnabled"
                            ]
                        },
                        "None"
                    ]
                }
            ]
        },
        "EFSFileSystemEnabled": {
            "Fn::Not": [
                {
                    "Fn::Equals": [
                        {
                            "Fn::FindInMap": [
                                {
                                    "Ref": "EnvShort"
                                },
                                {
                                    "Ref": "AWS::Region"
                                },
                                "EFSFileSystemEnabledEnabled"
                            ]
                        },
                        "None"
                    ]
                }
            ]
        },
        "EFSFileSystemName": {
            "Fn::Not": [
                {
                    "Fn::Equals": [
                        {
                            "Fn::FindInMap": [
                                {
                                    "Ref": "EnvShort"
                                },
                                {
                                    "Ref": "AWS::Region"
                                },
                                "EFSFileSystemNameEnabled"
                            ]
                        },
                        "None"
                    ]
                }
            ]
        },
        "EFSMountTargetEcsCluster0": {
            "Fn::And": [
                {
                    "Condition": "EFSFileSystemEcsCluster"
                },
                {
                    "Fn::Equals": [
                        {
                            "Fn::FindInMap": [
                                "AvabilityZones",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "Zone0"
                            ]
                        },
                        "True"
                    ]
                }
            ]
        },
        "EFSMountTargetEcsCluster1": {
            "Fn::And": [
                {
                    "Condition": "EFSFileSystemEcsCluster"
                },
                {
                    "Fn::Equals": [
                        {
                            "Fn::FindInMap": [
                                "AvabilityZones",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "Zone1"
                            ]
                        },
                        "True"
                    ]
                }
            ]
        },
        "EFSMountTargetEcsCluster2": {
            "Fn::And": [
                {
                    "Condition": "EFSFileSystemEcsCluster"
                },
                {
                    "Fn::Equals": [
                        {
                            "Fn::FindInMap": [
                                "AvabilityZones",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "Zone2"
                            ]
                        },
                        "True"
                    ]
                }
            ]
        },
        "EFSMountTargetEcsCluster3": {
            "Fn::And": [
                {
                    "Condition": "EFSFileSystemEcsCluster"
                },
                {
                    "Fn::Equals": [
                        {
                            "Fn::FindInMap": [
                                "AvabilityZones",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "Zone3"
                            ]
                        },
                        "True"
                    ]
                }
            ]
        },
        "EFSMountTargetEcsCluster4": {
            "Fn::And": [
                {
                    "Condition": "EFSFileSystemEcsCluster"
                },
                {
                    "Fn::Equals": [
                        {
                            "Fn::FindInMap": [
                                "AvabilityZones",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "Zone4"
                            ]
                        },
                        "True"
                    ]
                }
            ]
        },
        "EFSMountTargetEcsCluster5": {
            "Fn::And": [
                {
                    "Condition": "EFSFileSystemEcsCluster"
                },
                {
                    "Fn::Equals": [
                        {
                            "Fn::FindInMap": [
                                "AvabilityZones",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "Zone5"
                            ]
                        },
                        "True"
                    ]
                }
            ]
        },
        "EFSMountTargetEnabled0": {
            "Fn::And": [
                {
                    "Condition": "EFSFileSystemEnabled"
                },
                {
                    "Fn::Equals": [
                        {
                            "Fn::FindInMap": [
                                "AvabilityZones",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "Zone0"
                            ]
                        },
                        "True"
                    ]
                }
            ]
        },
        "EFSMountTargetEnabled1": {
            "Fn::And": [
                {
                    "Condition": "EFSFileSystemEnabled"
                },
                {
                    "Fn::Equals": [
                        {
                            "Fn::FindInMap": [
                                "AvabilityZones",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "Zone1"
                            ]
                        },
                        "True"
                    ]
                }
            ]
        },
        "EFSMountTargetEnabled2": {
            "Fn::And": [
                {
                    "Condition": "EFSFileSystemEnabled"
                },
                {
                    "Fn::Equals": [
                        {
                            "Fn::FindInMap": [
                                "AvabilityZones",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "Zone2"
                            ]
                        },
                        "True"
                    ]
                }
            ]
        },
        "EFSMountTargetEnabled3": {
            "Fn::And": [
                {
                    "Condition": "EFSFileSystemEnabled"
                },
                {
                    "Fn::Equals": [
                        {
                            "Fn::FindInMap": [
                                "AvabilityZones",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "Zone3"
                            ]
                        },
                        "True"
                    ]
                }
            ]
        },
        "EFSMountTargetEnabled4": {
            "Fn::And": [
                {
                    "Condition": "EFSFileSystemEnabled"
                },
                {
                    "Fn::Equals": [
                        {
                            "Fn::FindInMap": [
                                "AvabilityZones",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "Zone4"
                            ]
                        },
                        "True"
                    ]
                }
            ]
        },
        "EFSMountTargetEnabled5": {
            "Fn::And": [
                {
                    "Condition": "EFSFileSystemEnabled"
                },
                {
                    "Fn::Equals": [
                        {
                            "Fn::FindInMap": [
                                "AvabilityZones",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "Zone5"
                            ]
                        },
                        "True"
                    ]
                }
            ]
        },
        "EFSMountTargetName0": {
            "Fn::And": [
                {
                    "Condition": "EFSFileSystemName"
                },
                {
                    "Fn::Equals": [
                        {
                            "Fn::FindInMap": [
                                "AvabilityZones",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "Zone0"
                            ]
                        },
                        "True"
                    ]
                }
            ]
        },
        "EFSMountTargetName1": {
            "Fn::And": [
                {
                    "Condition": "EFSFileSystemName"
                },
                {
                    "Fn::Equals": [
                        {
                            "Fn::FindInMap": [
                                "AvabilityZones",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "Zone1"
                            ]
                        },
                        "True"
                    ]
                }
            ]
        },
        "EFSMountTargetName2": {
            "Fn::And": [
                {
                    "Condition": "EFSFileSystemName"
                },
                {
                    "Fn::Equals": [
                        {
                            "Fn::FindInMap": [
                                "AvabilityZones",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "Zone2"
                            ]
                        },
                        "True"
                    ]
                }
            ]
        },
        "EFSMountTargetName3": {
            "Fn::And": [
                {
                    "Condition": "EFSFileSystemName"
                },
                {
                    "Fn::Equals": [
                        {
                            "Fn::FindInMap": [
                                "AvabilityZones",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "Zone3"
                            ]
                        },
                        "True"
                    ]
                }
            ]
        },
        "EFSMountTargetName4": {
            "Fn::And": [
                {
                    "Condition": "EFSFileSystemName"
                },
                {
                    "Fn::Equals": [
                        {
                            "Fn::FindInMap": [
                                "AvabilityZones",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "Zone4"
                            ]
                        },
                        "True"
                    ]
                }
            ]
        },
        "EFSMountTargetName5": {
            "Fn::And": [
                {
                    "Condition": "EFSFileSystemName"
                },
                {
                    "Fn::Equals": [
                        {
                            "Fn::FindInMap": [
                                "AvabilityZones",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "Zone5"
                            ]
                        },
                        "True"
                    ]
                }
            ]
        },
        "RegionAWSCloudFormationStackSetRoles": {
            "Fn::Equals": [
                {
                    "Ref": "RegionAWSCloudFormationStackSetRoles"
                },
                {
                    "Ref": "AWS::Region"
                }
            ]
        },
        "RegionAWSCloudFormationStackSetRolesOverride": {
            "Fn::Not": [
                {
                    "Fn::Equals": [
                        {
                            "Ref": "RegionAWSCloudFormationStackSetRoles"
                        },
                        ""
                    ]
                }
            ]
        }
    },
    "Description": "res-extra-01 [res]",
    "Mappings": {
        "AvabilityZones": {
            "eu-central-1": {
                "Zone0": "True",
                "Zone1": "True",
                "Zone2": "True",
                "Zone3": "False",
                "Zone4": "False",
                "Zone5": "False"
            },
            "eu-west-1": {
                "Zone0": "True",
                "Zone1": "True",
                "Zone2": "True",
                "Zone3": "False",
                "Zone4": "False",
                "Zone5": "False"
            },
            "us-east-1": {
                "Zone0": "True",
                "Zone1": "True",
                "Zone2": "True",
                "Zone3": "True",
                "Zone4": "True",
                "Zone5": "True"
            }
        }
    },
    "Outputs": {
        "BrandDomain": {
            "Value": "aman.arda"
        },
        "CacheSubnetGroupPrivate": {
            "Export": {
                "Name": "CacheSubnetGroupPrivate"
            },
            "Value": {
                "Ref": "CacheSubnetGroupPrivate"
            }
        },
        "CacheSubnetGroupPublic": {
            "Export": {
                "Name": "CacheSubnetGroupPublic"
            },
            "Value": {
                "Ref": "CacheSubnetGroupPublic"
            }
        },
        "DBSubnetGroupPrivate": {
            "Export": {
                "Name": "DBSubnetGroupPrivate"
            },
            "Value": {
                "Ref": "DBSubnetGroupPrivate"
            }
        },
        "DBSubnetGroupPublic": {
            "Export": {
                "Name": "DBSubnetGroupPublic"
            },
            "Value": {
                "Ref": "DBSubnetGroupPublic"
            }
        },
        "Env": {
            "Value": {
                "Ref": "Env"
            }
        },
        "EnvRole": {
            "Value": {
                "Ref": "EnvRole"
            }
        },
        "EnvStackVersion": {
            "Value": {
                "Ref": "EnvStackVersion"
            }
        },
        "SecurityGroupEFSEcsCluster": {
            "Condition": "EFSFileSystemEcsCluster",
            "Export": {
                "Name": "SecurityGroupEFSEcsCluster"
            },
            "Value": {
                "Fn::GetAtt": [
                    "SecurityGroupEFSEcsCluster",
                    "GroupId"
                ]
            }
        },
        "SecurityGroupEFSEnabled": {
            "Condition": "EFSFileSystemEnabled",
            "Export": {
                "Name": "SecurityGroupEFSEnabled"
            },
            "Value": {
                "Fn::GetAtt": [
                    "SecurityGroupEFSEnabled",
                    "GroupId"
                ]
            }
        },
        "SecurityGroupEFSName": {
            "Condition": "EFSFileSystemName",
            "Export": {
                "Name": "SecurityGroupEFSName"
            },
            "Value": {
                "Fn::GetAtt": [
                    "SecurityGroupEFSName",
                    "GroupId"
                ]
            }
        },
        "SecurityGroupRDS": {
            "Export": {
                "Name": "SecurityGroupRDS"
            },
            "Value": {
                "Fn::GetAtt": [
                    "SecurityGroupRDS",
                    "GroupId"
                ]
            }
        },
        "StackType": {
            "Value": "res"
        }
    },
    "Parameters": {
        "Env": {
            "AllowedValues": [
                "dev",
                "stg",
                "prod"
            ],
            "Default": "dev",
            "Description": "Environment",
            "Type": "String"
        },
        "EnvRole": {
            "AllowedPattern": "^[a-zA-Z0-9-_.]*$",
            "Default": "",
            "Description": "Service Role",
            "Type": "String"
        },
        "EnvShort": {
            "AllowedValues": [
                "dev",
                "stg",
                "prd"
            ],
            "Default": "dev",
            "Description": "Environment Short - NEVER CHANGE!",
            "Type": "String"
        },
        "EnvStackVersion": {
            "Default": "1",
            "Description": "Stack version, if changed with UpdateMode=Cfn triggers cfn-hup",
            "Type": "String"
        },
        "RegionAWSCloudFormationStackSetRoles": {
            "AllowedValues": [
                "eu-west-1",
                "us-east-1",
                "eu-central-1"
            ],
            "Default": "eu-west-1",
            "Description": "Region where create AWSCloudFormationStackSet Roles",
            "Type": "String"
        }
    },
    "Resources": {
        "ApiGatewayAccount": {
            "Properties": {
                "CloudWatchRoleArn": {
                    "Fn::ImportValue": "RoleApiGatewayCloudWatch"
                }
            },
            "Type": "AWS::ApiGateway::Account"
        },
        "CacheSubnetGroupPrivate": {
            "Properties": {
                "Description": {
                    "Fn::Sub": "${EnvShort}-Private"
                },
                "SubnetIds": {
                    "Fn::Split": [
                        ",",
                        {
                            "Fn::ImportValue": "SubnetsPrivate"
                        }
                    ]
                }
            },
            "Type": "AWS::ElastiCache::SubnetGroup"
        },
        "CacheSubnetGroupPublic": {
            "Properties": {
                "Description": {
                    "Fn::Sub": "${EnvShort}-Public"
                },
                "SubnetIds": {
                    "Fn::Split": [
                        ",",
                        {
                            "Fn::ImportValue": "SubnetsPublic"
                        }
                    ]
                }
            },
            "Type": "AWS::ElastiCache::SubnetGroup"
        },
        "DBSubnetGroupPrivate": {
            "Properties": {
                "DBSubnetGroupDescription": {
                    "Fn::Sub": "${EnvShort}-Private"
                },
                "SubnetIds": {
                    "Fn::Split": [
                        ",",
                        {
                            "Fn::ImportValue": "SubnetsPrivate"
                        }
                    ]
                }
            },
            "Type": "AWS::RDS::DBSubnetGroup"
        },
        "DBSubnetGroupPublic": {
            "Properties": {
                "DBSubnetGroupDescription": {
                    "Fn::Sub": "${EnvShort}-Public"
                },
                "SubnetIds": {
                    "Fn::Split": [
                        ",",
                        {
                            "Fn::ImportValue": "SubnetsPublic"
                        }
                    ]
                }
            },
            "Type": "AWS::RDS::DBSubnetGroup"
        },
        "EFSFileSystemEcsCluster": {
            "Condition": "EFSFileSystemEcsCluster",
            "Properties": {
                "Encrypted": "false",
                "PerformanceMode": "generalPurpose"
            },
            "Type": "AWS::EFS::FileSystem"
        },
        "EFSFileSystemEnabled": {
            "Condition": "EFSFileSystemEnabled",
            "Properties": {
                "Encrypted": "false",
                "PerformanceMode": "generalPurpose"
            },
            "Type": "AWS::EFS::FileSystem"
        },
        "EFSFileSystemName": {
            "Condition": "EFSFileSystemName",
            "Properties": {
                "Encrypted": "false",
                "PerformanceMode": "generalPurpose"
            },
            "Type": "AWS::EFS::FileSystem"
        },
        "EFSMountTargetEcsCluster0": {
            "Condition": "EFSMountTargetEcsCluster0",
            "Properties": {
                "FileSystemId": {
                    "Ref": "EFSFileSystemEcsCluster"
                },
                "SecurityGroups": [
                    {
                        "Ref": "SecurityGroupEFSServerEcsCluster"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Fn::Split": [
                                ",",
                                {
                                    "Fn::ImportValue": "SubnetsPrivate"
                                }
                            ]
                        }
                    ]
                }
            },
            "Type": "AWS::EFS::MountTarget"
        },
        "EFSMountTargetEcsCluster1": {
            "Condition": "EFSMountTargetEcsCluster1",
            "Properties": {
                "FileSystemId": {
                    "Ref": "EFSFileSystemEcsCluster"
                },
                "SecurityGroups": [
                    {
                        "Ref": "SecurityGroupEFSServerEcsCluster"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "1",
                        {
                            "Fn::Split": [
                                ",",
                                {
                                    "Fn::ImportValue": "SubnetsPrivate"
                                }
                            ]
                        }
                    ]
                }
            },
            "Type": "AWS::EFS::MountTarget"
        },
        "EFSMountTargetEcsCluster2": {
            "Condition": "EFSMountTargetEcsCluster2",
            "Properties": {
                "FileSystemId": {
                    "Ref": "EFSFileSystemEcsCluster"
                },
                "SecurityGroups": [
                    {
                        "Ref": "SecurityGroupEFSServerEcsCluster"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "2",
                        {
                            "Fn::Split": [
                                ",",
                                {
                                    "Fn::ImportValue": "SubnetsPrivate"
                                }
                            ]
                        }
                    ]
                }
            },
            "Type": "AWS::EFS::MountTarget"
        },
        "EFSMountTargetEcsCluster3": {
            "Condition": "EFSMountTargetEcsCluster3",
            "Properties": {
                "FileSystemId": {
                    "Ref": "EFSFileSystemEcsCluster"
                },
                "SecurityGroups": [
                    {
                        "Ref": "SecurityGroupEFSServerEcsCluster"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "3",
                        {
                            "Fn::Split": [
                                ",",
                                {
                                    "Fn::ImportValue": "SubnetsPrivate"
                                }
                            ]
                        }
                    ]
                }
            },
            "Type": "AWS::EFS::MountTarget"
        },
        "EFSMountTargetEcsCluster4": {
            "Condition": "EFSMountTargetEcsCluster4",
            "Properties": {
                "FileSystemId": {
                    "Ref": "EFSFileSystemEcsCluster"
                },
                "SecurityGroups": [
                    {
                        "Ref": "SecurityGroupEFSServerEcsCluster"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "4",
                        {
                            "Fn::Split": [
                                ",",
                                {
                                    "Fn::ImportValue": "SubnetsPrivate"
                                }
                            ]
                        }
                    ]
                }
            },
            "Type": "AWS::EFS::MountTarget"
        },
        "EFSMountTargetEcsCluster5": {
            "Condition": "EFSMountTargetEcsCluster5",
            "Properties": {
                "FileSystemId": {
                    "Ref": "EFSFileSystemEcsCluster"
                },
                "SecurityGroups": [
                    {
                        "Ref": "SecurityGroupEFSServerEcsCluster"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "5",
                        {
                            "Fn::Split": [
                                ",",
                                {
                                    "Fn::ImportValue": "SubnetsPrivate"
                                }
                            ]
                        }
                    ]
                }
            },
            "Type": "AWS::EFS::MountTarget"
        },
        "EFSMountTargetEnabled0": {
            "Condition": "EFSMountTargetEnabled0",
            "Properties": {
                "FileSystemId": {
                    "Ref": "EFSFileSystemEnabled"
                },
                "SecurityGroups": [
                    {
                        "Ref": "SecurityGroupEFSServerEnabled"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Fn::Split": [
                                ",",
                                {
                                    "Fn::ImportValue": "SubnetsPrivate"
                                }
                            ]
                        }
                    ]
                }
            },
            "Type": "AWS::EFS::MountTarget"
        },
        "EFSMountTargetEnabled1": {
            "Condition": "EFSMountTargetEnabled1",
            "Properties": {
                "FileSystemId": {
                    "Ref": "EFSFileSystemEnabled"
                },
                "SecurityGroups": [
                    {
                        "Ref": "SecurityGroupEFSServerEnabled"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "1",
                        {
                            "Fn::Split": [
                                ",",
                                {
                                    "Fn::ImportValue": "SubnetsPrivate"
                                }
                            ]
                        }
                    ]
                }
            },
            "Type": "AWS::EFS::MountTarget"
        },
        "EFSMountTargetEnabled2": {
            "Condition": "EFSMountTargetEnabled2",
            "Properties": {
                "FileSystemId": {
                    "Ref": "EFSFileSystemEnabled"
                },
                "SecurityGroups": [
                    {
                        "Ref": "SecurityGroupEFSServerEnabled"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "2",
                        {
                            "Fn::Split": [
                                ",",
                                {
                                    "Fn::ImportValue": "SubnetsPrivate"
                                }
                            ]
                        }
                    ]
                }
            },
            "Type": "AWS::EFS::MountTarget"
        },
        "EFSMountTargetEnabled3": {
            "Condition": "EFSMountTargetEnabled3",
            "Properties": {
                "FileSystemId": {
                    "Ref": "EFSFileSystemEnabled"
                },
                "SecurityGroups": [
                    {
                        "Ref": "SecurityGroupEFSServerEnabled"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "3",
                        {
                            "Fn::Split": [
                                ",",
                                {
                                    "Fn::ImportValue": "SubnetsPrivate"
                                }
                            ]
                        }
                    ]
                }
            },
            "Type": "AWS::EFS::MountTarget"
        },
        "EFSMountTargetEnabled4": {
            "Condition": "EFSMountTargetEnabled4",
            "Properties": {
                "FileSystemId": {
                    "Ref": "EFSFileSystemEnabled"
                },
                "SecurityGroups": [
                    {
                        "Ref": "SecurityGroupEFSServerEnabled"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "4",
                        {
                            "Fn::Split": [
                                ",",
                                {
                                    "Fn::ImportValue": "SubnetsPrivate"
                                }
                            ]
                        }
                    ]
                }
            },
            "Type": "AWS::EFS::MountTarget"
        },
        "EFSMountTargetEnabled5": {
            "Condition": "EFSMountTargetEnabled5",
            "Properties": {
                "FileSystemId": {
                    "Ref": "EFSFileSystemEnabled"
                },
                "SecurityGroups": [
                    {
                        "Ref": "SecurityGroupEFSServerEnabled"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "5",
                        {
                            "Fn::Split": [
                                ",",
                                {
                                    "Fn::ImportValue": "SubnetsPrivate"
                                }
                            ]
                        }
                    ]
                }
            },
            "Type": "AWS::EFS::MountTarget"
        },
        "EFSMountTargetName0": {
            "Condition": "EFSMountTargetName0",
            "Properties": {
                "FileSystemId": {
                    "Ref": "EFSFileSystemName"
                },
                "SecurityGroups": [
                    {
                        "Ref": "SecurityGroupEFSServerName"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "0",
                        {
                            "Fn::Split": [
                                ",",
                                {
                                    "Fn::ImportValue": "SubnetsPrivate"
                                }
                            ]
                        }
                    ]
                }
            },
            "Type": "AWS::EFS::MountTarget"
        },
        "EFSMountTargetName1": {
            "Condition": "EFSMountTargetName1",
            "Properties": {
                "FileSystemId": {
                    "Ref": "EFSFileSystemName"
                },
                "SecurityGroups": [
                    {
                        "Ref": "SecurityGroupEFSServerName"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "1",
                        {
                            "Fn::Split": [
                                ",",
                                {
                                    "Fn::ImportValue": "SubnetsPrivate"
                                }
                            ]
                        }
                    ]
                }
            },
            "Type": "AWS::EFS::MountTarget"
        },
        "EFSMountTargetName2": {
            "Condition": "EFSMountTargetName2",
            "Properties": {
                "FileSystemId": {
                    "Ref": "EFSFileSystemName"
                },
                "SecurityGroups": [
                    {
                        "Ref": "SecurityGroupEFSServerName"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "2",
                        {
                            "Fn::Split": [
                                ",",
                                {
                                    "Fn::ImportValue": "SubnetsPrivate"
                                }
                            ]
                        }
                    ]
                }
            },
            "Type": "AWS::EFS::MountTarget"
        },
        "EFSMountTargetName3": {
            "Condition": "EFSMountTargetName3",
            "Properties": {
                "FileSystemId": {
                    "Ref": "EFSFileSystemName"
                },
                "SecurityGroups": [
                    {
                        "Ref": "SecurityGroupEFSServerName"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "3",
                        {
                            "Fn::Split": [
                                ",",
                                {
                                    "Fn::ImportValue": "SubnetsPrivate"
                                }
                            ]
                        }
                    ]
                }
            },
            "Type": "AWS::EFS::MountTarget"
        },
        "EFSMountTargetName4": {
            "Condition": "EFSMountTargetName4",
            "Properties": {
                "FileSystemId": {
                    "Ref": "EFSFileSystemName"
                },
                "SecurityGroups": [
                    {
                        "Ref": "SecurityGroupEFSServerName"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "4",
                        {
                            "Fn::Split": [
                                ",",
                                {
                                    "Fn::ImportValue": "SubnetsPrivate"
                                }
                            ]
                        }
                    ]
                }
            },
            "Type": "AWS::EFS::MountTarget"
        },
        "EFSMountTargetName5": {
            "Condition": "EFSMountTargetName5",
            "Properties": {
                "FileSystemId": {
                    "Ref": "EFSFileSystemName"
                },
                "SecurityGroups": [
                    {
                        "Ref": "SecurityGroupEFSServerName"
                    }
                ],
                "SubnetId": {
                    "Fn::Select": [
                        "5",
                        {
                            "Fn::Split": [
                                ",",
                                {
                                    "Fn::ImportValue": "SubnetsPrivate"
                                }
                            ]
                        }
                    ]
                }
            },
            "Type": "AWS::EFS::MountTarget"
        },
        "IAMPolicyAssumeRoleAWSCloudFormationStackSetExecutionRole": {
            "Condition": "RegionAWSCloudFormationStackSetRoles",
            "Properties": {
                "Description": "Assume Role AWSCloudFormationStackSetExecutionRole",
                "PolicyDocument": {
                    "Statement": [
                        {
                            "Action": "sts:AssumeRole",
                            "Effect": "Allow",
                            "Resource": "arn:aws:iam::*:role/AWSCloudFormationStackSetExecutionRole"
                        }
                    ],
                    "Version": "2012-10-17"
                }
            },
            "Type": "AWS::IAM::ManagedPolicy"
        },
        "RecordSetEFSEcsCluster": {
            "Condition": "EFSFileSystemEcsCluster",
            "Properties": {
                "HostedZoneId": {
                    "Ref": "HostedZonePrivate"
                },
                "Name": {
                    "Fn::Sub": "efs-EcsCluster.internal.aman.arda"
                },
                "ResourceRecords": [
                    {
                        "Fn::Sub": "${EFSFileSystemEcsCluster}.efs.${AWS::Region}.amazonaws.com"
                    }
                ],
                "TTL": "300",
                "Type": "CNAME"
            },
            "Type": "AWS::Route53::RecordSet"
        },
        "RecordSetEFSEnabled": {
            "Condition": "EFSFileSystemEnabled",
            "Properties": {
                "HostedZoneId": {
                    "Ref": "HostedZonePrivate"
                },
                "Name": {
                    "Fn::Sub": "efs-Enabled.internal.aman.arda"
                },
                "ResourceRecords": [
                    {
                        "Fn::Sub": "${EFSFileSystemEnabled}.efs.${AWS::Region}.amazonaws.com"
                    }
                ],
                "TTL": "300",
                "Type": "CNAME"
            },
            "Type": "AWS::Route53::RecordSet"
        },
        "RecordSetEFSName": {
            "Condition": "EFSFileSystemName",
            "Properties": {
                "HostedZoneId": {
                    "Ref": "HostedZonePrivate"
                },
                "Name": {
                    "Fn::Sub": "efs-Name.internal.aman.arda"
                },
                "ResourceRecords": [
                    {
                        "Fn::Sub": "${EFSFileSystemName}.efs.${AWS::Region}.amazonaws.com"
                    }
                ],
                "TTL": "300",
                "Type": "CNAME"
            },
            "Type": "AWS::Route53::RecordSet"
        },
        "RoleAWSCloudFormationStackSetAdministrationRole": {
            "Condition": "RegionAWSCloudFormationStackSetRoles",
            "Properties": {
                "AssumeRolePolicyDocument": {
                    "Statement": [
                        {
                            "Action": "sts:AssumeRole",
                            "Effect": "Allow",
                            "Principal": {
                                "Service": [
                                    "cloudformation.amazonaws.com"
                                ]
                            }
                        }
                    ]
                },
                "ManagedPolicyArns": [
                    {
                        "Ref": "IAMPolicyAssumeRoleAWSCloudFormationStackSetExecutionRole"
                    }
                ],
                "Path": "/",
                "RoleName": "AWSCloudFormationStackSetAdministrationRole"
            },
            "Type": "AWS::IAM::Role"
        },
        "RoleAWSCloudFormationStackSetExecutionRole": {
            "Condition": "RegionAWSCloudFormationStackSetRoles",
            "Properties": {
                "AssumeRolePolicyDocument": {
                    "Statement": [
                        {
                            "Action": "sts:AssumeRole",
                            "Effect": "Allow",
                            "Principal": {
                                "AWS": [
                                    {
                                        "Fn::GetAtt": [
                                            "RoleAWSCloudFormationStackSetAdministrationRole",
                                            "Arn"
                                        ]
                                    }
                                ]
                            }
                        }
                    ]
                },
                "ManagedPolicyArns": [
                    "arn:aws:iam::aws:policy/AdministratorAccess"
                ],
                "Path": "/",
                "RoleName": "AWSCloudFormationStackSetExecutionRole"
            },
            "Type": "AWS::IAM::Role"
        },
        "SecurityGroupEFSEcsCluster": {
            "Condition": "EFSFileSystemEcsCluster",
            "Properties": {
                "GroupDescription": "Enable access to EFS FileSystem EcsCluster",
                "VpcId": {
                    "Fn::ImportValue": "VpcId"
                }
            },
            "Type": "AWS::EC2::SecurityGroup"
        },
        "SecurityGroupEFSEnabled": {
            "Condition": "EFSFileSystemEnabled",
            "Properties": {
                "GroupDescription": "Enable access to EFS FileSystem Enabled",
                "VpcId": {
                    "Fn::ImportValue": "VpcId"
                }
            },
            "Type": "AWS::EC2::SecurityGroup"
        },
        "SecurityGroupEFSName": {
            "Condition": "EFSFileSystemName",
            "Properties": {
                "GroupDescription": "Enable access to EFS FileSystem Name",
                "VpcId": {
                    "Fn::ImportValue": "VpcId"
                }
            },
            "Type": "AWS::EC2::SecurityGroup"
        },
        "SecurityGroupEFSServerEcsCluster": {
            "Condition": "EFSFileSystemEcsCluster",
            "Properties": {
                "GroupDescription": "Rule to access EFS FileSystem EcsCluster",
                "VpcId": {
                    "Fn::ImportValue": "VpcId"
                }
            },
            "Type": "AWS::EC2::SecurityGroup"
        },
        "SecurityGroupEFSServerEnabled": {
            "Condition": "EFSFileSystemEnabled",
            "Properties": {
                "GroupDescription": "Rule to access EFS FileSystem Enabled",
                "VpcId": {
                    "Fn::ImportValue": "VpcId"
                }
            },
            "Type": "AWS::EC2::SecurityGroup"
        },
        "SecurityGroupEFSServerName": {
            "Condition": "EFSFileSystemName",
            "Properties": {
                "GroupDescription": "Rule to access EFS FileSystem Name",
                "VpcId": {
                    "Fn::ImportValue": "VpcId"
                }
            },
            "Type": "AWS::EC2::SecurityGroup"
        },
        "SecurityGroupIngressEFSEcsCluster": {
            "Condition": "EFSFileSystemEcsCluster",
            "Properties": {
                "FromPort": 2049,
                "GroupId": {
                    "Fn::Sub": "${SecurityGroupEFSServerEcsCluster.GroupId}"
                },
                "IpProtocol": "tcp",
                "SourceSecurityGroupId": {
                    "Ref": "SecurityGroupEFSEcsCluster"
                },
                "ToPort": 2049
            },
            "Type": "AWS::EC2::SecurityGroupIngress"
        },
        "SecurityGroupIngressEFSEnabled": {
            "Condition": "EFSFileSystemEnabled",
            "Properties": {
                "FromPort": 2049,
                "GroupId": {
                    "Fn::Sub": "${SecurityGroupEFSServerEnabled.GroupId}"
                },
                "IpProtocol": "tcp",
                "SourceSecurityGroupId": {
                    "Ref": "SecurityGroupEFSEnabled"
                },
                "ToPort": 2049
            },
            "Type": "AWS::EC2::SecurityGroupIngress"
        },
        "SecurityGroupIngressEFSName": {
            "Condition": "EFSFileSystemName",
            "Properties": {
                "FromPort": 2049,
                "GroupId": {
                    "Fn::Sub": "${SecurityGroupEFSServerName.GroupId}"
                },
                "IpProtocol": "tcp",
                "SourceSecurityGroupId": {
                    "Ref": "SecurityGroupEFSName"
                },
                "ToPort": 2049
            },
            "Type": "AWS::EC2::SecurityGroupIngress"
        },
        "SecurityGroupRDS": {
            "Properties": {
                "GroupDescription": "Assign to RDS Client",
                "VpcId": {
                    "Fn::ImportValue": "VpcId"
                }
            },
            "Type": "AWS::EC2::SecurityGroup"
        }
    }
}
